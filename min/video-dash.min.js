(()=>{return(t,a)=>{const r=t=>{return{url:t.downloadUrl,backupUrls:t.backupUrls,length:t.duration,size:Math.trunc(t.bandWidth*t.duration/8)}};const e=async(t,a)=>{const r=await Ajax.getJsonWithCredentials(t);const e=r.data||r.result||r;if(r.code!==0||!e.dash){throw new Error("DASH api failed")}const d=e.accept_quality;if(!d.includes(a)){throw new Error("没有找到请求的清晰度")}if(e.quality!==a){throw new Error("无法获取请求的清晰度, 请确认当前账号有相应的权限")}const c=e.accept_description;const o=c[d.indexOf(a)];const s=e.dash.duration;const n=e.dash.video.filter(t=>t.id===a).map(t=>{const r={quality:a,qualityText:o,width:t.width,height:t.height,codecs:t.codecs,codecId:t.codecid,bandWidth:t.bandwidth,frameRate:t.frameRate,backupUrls:(t.backupUrl||t.backup_url||"").replace("http:","https:"),downloadUrl:(t.baseUrl||t.base_url||"").replace("http:","https:"),duration:s};return r});const i=e.dash.audio.map(t=>{return{bandWidth:t.bandwidth,codecs:t.codecs,codecId:t.codecid,backupUrls:(t.backupUrl||t.backup_url||"").replace("http:","https:"),downloadUrl:(t.baseUrl||t.base_url||"").replace("http:","https:"),duration:s}});return{videoDashes:n,audioDashes:i}};return{export:{getDashInfo:e,dashToFragment:r}}}})();