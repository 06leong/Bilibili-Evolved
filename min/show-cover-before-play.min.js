(()=>{return(e,o)=>{const n={include:["//www.bilibili.com/video/","//www.bilibili.com/bangumi/"]};const t="showCoverBeforePlayStyle";let i;const r=()=>{const e=async()=>{if(n.include.every(e=>!document.URL.includes(e))){return}const e=()=>document.body.style.removeProperty("--cover-url");const r=HTMLVideoElement.prototype.play;HTMLVideoElement.prototype.play=function(...o){e();return r.call(this,...o)};o.applyStyle(t);const l=await SpinQuery.select(()=>unsafeWindow.aid);if(!l){console.warn("[播放前显示封面] 未找到av号");return}const{cid:c}=unsafeWindow;if(c===i||!c){return}i=c;const{VideoInfo:s}=await o.importAsync("video-info");const u=new s(l);await u.fetchInfo();if(!dq("video").paused){return}document.body.style.setProperty("--cover-url",`url('${u.coverUrl}')`)};if(document.URL.includes("//www.bilibili.com/bangumi/")){Observer.videoChange(e)}else{e()}};r();return{reload:()=>o.applyStyle(t),unload:()=>o.removeStyle(t)}}})();