(()=>{return(e,n)=>{const o={include:["//www.bilibili.com/video/","//www.bilibili.com/bangumi/"]};const i="showCoverBeforePlayStyle";let t;const r=()=>{const e=async()=>{if(o.include.every(e=>!document.URL.includes(e))){return}const e=()=>document.body.style.removeProperty("--cover-url");n.applyStyle(i);const r=await SpinQuery.select(()=>unsafeWindow.aid);if(!r){console.warn("[播放前显示封面] 未找到av号");e();return}const{cid:c}=unsafeWindow;if(c===t||!c){e();return}t=c;const l=await SpinQuery.select("video");if(!l){console.warn("[播放前显示封面] 未找到视频");e();return}const{VideoInfo:s}=await n.importAsync("video-info");const u=new s(r);await u.fetchInfo();if(!l.paused){e();return}document.body.style.setProperty("--cover-url",`url('${u.coverUrl}')`);l.addEventListener("play",()=>{e()},{once:true})};if(document.URL.includes("//www.bilibili.com/bangumi/")){Observer.videoChange(e)}else{e()}};r();return{reload:()=>n.applyStyle(i),unload:()=>n.removeStyle(i)}}})();