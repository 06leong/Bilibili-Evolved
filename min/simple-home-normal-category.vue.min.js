(()=>{return(i,t)=>{const e=`<div class=category-view :class="{'new-activity-loading': newActivity.loading,'new-post-loading': newPost.loading,'rank-loading': rank.loading}"><slideshow-cards class=new-activity :cards=newActivity.videos :error=newActivity.error :show-stat=true @refresh=loadNewActivity() title=有新动态></slideshow-cards><slideshow-cards class=new-post :cards=newPost.videos :error=newPost.errors :show-stat=false @refresh=loadNewPost() title=最新发布></slideshow-cards><div class=rank><a class=rank-item v-for="(c, index) of rank.videos":key=c.id target=_blank :href="'https://www.bilibili.com/av' + c.aid"><div class=cover><dpi-img :src=c.coverUrl :size="{ width: 200, height: 120 }"></dpi-img></div><div class=rank-number>{{index + 1}}</div><div class=grow></div><div class=title>{{c.title}}</div><div class=up><div class=points><icon icon=fire type=mdi></icon>{{c.points | bigNumber}}</div><div class=up-info><icon icon=up type=extended></icon><div class=up-name>{{c.upName}}</div></div></div><div class=stats><icon type=extended icon=play></icon><div class=number>{{c.playCount | bigNumber}}</div><icon type=extended icon=coin></icon><div class=number>{{c.coins | bigNumber}}</div><icon type=extended icon=favorites></icon><div class=number>{{c.favorites | bigNumber}}</div></div></a></div><div class="new-activity loading"></div><div class="new-post loading"></div><div class="rank loading"></div></div>`;t.applyStyleFromText(`.category-view{display:grid;grid-template:"new-activity rank" 1fr "new-post rank" 1fr/3fr 1fr;grid-gap:24px;gap:24px;--loading-from:#d4d4d4;--loading-to:#ddd}.category-view,.category-view *,.category-view ::after,.category-view ::before{transition:.2s ease-out}@keyframes normal-category-loading{from{background-color:var(--loading-from)}to{background-color:var(--loading-to)}}body.dark .category-view{--loading-from:#333;--loading-to:#262626}.category-view .loading{opacity:0;pointer-events:none;border-radius:16px;animation:.64s ease-in-out infinite alternate normal-category-loading;position:absolute}.category-view .rank .rank-item{border-radius:16px;grid-column:1/3;box-shadow:0 4px 8px 0 #0001;color:inherit!important;position:relative}.category-view .rank .rank-item .cover{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:16px;overflow:hidden}.category-view .rank .rank-item .cover img{width:100%;height:100%;object-fit:cover}.category-view .rank .rank-item:hover .cover img{transform:scale(1.05)}.category-view .rank .rank-item .rank-number{position:absolute;top:6px;left:6px;width:22px;height:22px;line-height:22px;border-radius:50%;box-sizing:border-box;text-align:center;font-weight:700;font-size:13px;background-color:#ddd}body.dark .category-view .rank .rank-item .rank-number{background-color:#333}.category-view .rank .rank-item>:not(.cover):not(.rank-number){z-index:10}.category-view .rank .rank-item .be-icon{font-size:16px}.category-view .rank .rank-item:first-child .rank-number,.category-view .rank .rank-item:nth-child(2) .rank-number,.category-view .rank .rank-item:nth-child(3) .rank-number{background-color:var(--theme-color);color:var(--foreground-color)}.category-view .rank .rank-item:first-child{grid-area:first;display:flex;flex-direction:column;justify-content:flex-end;align-items:flex-start}.category-view .rank .rank-item:first-child::after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;border-radius:16px;background-image:linear-gradient(to top,#000a 0,transparent 61%);z-index:9}.category-view .rank .rank-item:first-child .grow{flex:1 0 0}.category-view .rank .rank-item:first-child .title{font-weight:700;font-size:16px;line-height:1.5;color:#fff;padding:0 8px}.category-view .rank .rank-item:first-child .up{display:flex;align-self:stretch;justify-content:space-between;align-items:center;opacity:.75;color:#fff;padding:0 12px 0 6px;margin:4px 0 8px}.category-view .rank .rank-item:first-child .up>*{display:flex;align-items:center}.category-view .rank .rank-item:first-child .up .mdi-fire{transform:scale(calc(18 / 16));margin-right:2px}.category-view .rank .rank-item:first-child .up .be-iconfont-up{margin-right:4px}.category-view .rank .rank-item:first-child .up .points{flex-shrink:0;margin-right:8px}.category-view .rank .rank-item:first-child .up .up-info{max-width:61%}.category-view .rank .rank-item:first-child .up .up-info .up-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;word-break:break-all}.category-view .rank .rank-item:first-child .stats{display:flex;justify-content:flex-start;align-items:center;color:#fff;opacity:0;padding:0 8px;position:absolute;bottom:8px;left:0}.category-view .rank .rank-item:first-child .stats .be-icon{margin:0 2px 0 8px}.category-view .rank .rank-item:first-child .stats .be-icon:first-child{margin-left:0}.category-view .rank .rank-item:first-child:hover .up{opacity:0}.category-view .rank .rank-item:first-child:hover .stats{opacity:.75}.category-view .rank .rank-item:nth-child(2){grid-area:second}.category-view .rank .rank-item:nth-child(3){grid-area:third}.category-view .new-activity{grid-area:new-activity}.category-view.new-activity-loading .new-activity.loading{position:static;opacity:1;pointer-events:initial}.category-view.new-activity-loading .new-activity:not(.loading){opacity:0;pointer-events:none}.category-view .new-post{grid-area:new-post}.category-view.new-post-loading .new-post.loading{position:static;opacity:1;pointer-events:initial}.category-view.new-post-loading .new-post:not(.loading){opacity:0;pointer-events:none}.category-view .rank{display:grid;width:290px;grid-template:"first first" 170px "second third" 85px/1fr 1fr;grid-gap:10px;gap:10px;grid-area:rank}.category-view.rank-loading .rank.loading{position:static;opacity:1;pointer-events:initial}.category-view.rank-loading .rank:not(.loading){opacity:0;pointer-events:none}`,"simple-home-normal-category-style");return{export:Object.assign({template:e},{components:{SlideshowCards:()=>t.importAsync("slideshow-cards.vue"),Icon:()=>t.importAsync("icon.vue"),DpiImg:()=>t.importAsync("dpi-img.vue")},filters:{bigNumber(i){return formatCount(i)}},props:{rid:{type:Number,required:true}},data(){return{newActivity:{error:false,loading:true,videos:[]},newPost:{error:false,loading:true,videos:[]},rank:{error:false,loading:true,videos:[]},watchlaterList:null}},methods:{async loadCards(i,e,a){if(a===undefined){a=(i=>{const t=getUID();const e=_.get(i,"data.archives",[]);return e.map(i=>{return{id:i.aid,aid:i.aid,coverUrl:i.pic.replace("http:","https:"),title:i.title,upName:i.owner.name,upFaceUrl:i.owner.face.replace("http:","https:"),upID:i.owner.mid,playCount:i.stat.view,danmakuCount:i.stat.danmaku,like:i.stat.like,coins:i.stat.coin,description:i.desc,type:i.tname,watchlater:t?this.watchlaterList.includes(i.aid):null}})})}try{this[i].loading=true;const r=await Ajax.getJson(e);if(r.code!==0){this[i].error=true}const{getWatchlaterList:n}=await t.importAsync("watchlater-api");if(this.watchlaterList===null){const i=getUID();this.watchlaterList=i?await n():[]}this[i].videos=a(r)}catch(i){logError(i)}finally{this[i].loading=false}},async loadNewActivity(){await this.loadCards("newActivity",`https://api.bilibili.com/x/web-interface/dynamic/region?ps=10&rid=${this.rid}`)},async loadNewPost(){await this.loadCards("newPost",`https://api.bilibili.com/x/web-interface/newlist?ps=10&rid=${this.rid}`)},async loadRank(){await this.loadCards("rank",`https://api.bilibili.com/x/web-interface/ranking/region?rid=${this.rid}&day=3&original=0`,i=>{const t=getUID();const e=i.data;return e.map(i=>{return{id:i.aid,aid:parseInt(i.aid),title:i.title,playCount:i.play,favorites:i.favorites,upID:i.mid,upName:i.author,description:i.description,coverUrl:i.pic.replace("http:","https:"),coins:i.coins,durationText:i.duration,points:i.pts,watchlater:t?this.watchlaterList.includes(parseInt(i.aid)):null}})})},updateVideos(){this.loadNewActivity();this.loadNewPost();this.loadRank()}},watch:{rid(i){if(i>0){this.updateVideos()}else{console.warn(`rid=${i}`)}}},mounted(){console.log(this.rid);this.updateVideos()}})}}})();